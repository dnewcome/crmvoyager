
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>CRM Voyager</title>
  <meta name="author" content="Dan Newcome">

  
  <meta name="description" content="Hey guys, back after a bit of a break in blogging. I&#8217;ve been super busy on a lot of projects. Here is a little tip that I found out about when &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://crmvoyager.com/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="CRM Voyager" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-10833846-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">CRM Voyager</a></h1>
  
    <h2>Navigating the high seas of Microsoft CRM.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:crmvoyager.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>

<div id="adsense" style="border: 1px solid black">
	<script type="text/javascript"><!--
		google_ad_client = "ca-pub-5305300577407644";
		/* CRM Voyager */
		google_ad_slot = "1427166023";
		google_ad_width = 728;
		google_ad_height = 90;
		//-->
		</script>
		<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script>
</div>

  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/20/running-microsoft-crm-4-0-apps-when-2011-is-installed/">Running Microsoft CRM 4.0 Apps When 2011 Is Installed</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-20T16:27:49-07:00" pubdate data-updated="true">Oct 20<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hey guys, back after a bit of a break in blogging. I&#8217;ve been super busy on a lot of projects.</p>

<p>Here is a little tip that I found out about when I tried to consolidate my development environment a bit. I&#8217;m now running a CRM 2011 server on my dev machine. Unfortunately I also still need to support clients that are on CRM 4.0.</p>

<p>I didn&#8217;t think that this should be a problem since I have the 4.0 server on another box. However it seems that there is a conflict when the .NET runtime tries to locate the 4.0 SDK assembly. Since CRM 2011 supports backward compatibility by exposing support for the old SDK, it supplies its own version of Microsoft.Crm.Sdk.dll. The difference is that it is strongly signed with an updated version number of 5.0.0.0.</p>

<p>Here is the error that we get if we try to run a project compiled against the 4.0 SDK on a machine that has CRM 2011 installed (even though we are using the service endpoint of the CRM 4.0 server):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>Error: Could not load file or assembly 'Microsoft.Crm.Sdk, Version=5.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35' or one of its dependencies. The located assembly's manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)      
</span></code></pre></td></tr></table></div></figure>


<p>We can force the runtime to load our own supplied version of Microsoft.Crm.Sdk by overriding the publisher policy. This is done in App.config (or Web.config for a web application) using the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>...
</span><span class='line'> <span class="nt">&lt;runtime&gt;</span>
</span><span class='line'>    <span class="nt">&lt;assemblyBinding</span> <span class="na">xmlns=</span><span class="s">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;dependentAssembly&gt;</span>
</span><span class='line'>        <span class="nt">&lt;assemblyIdentity</span> <span class="na">name=</span><span class="s">&quot;Microsoft.Crm.Sdk&quot;</span> <span class="na">publicKeyToken=</span><span class="s">&quot;31bf3856ad364e35&quot;</span> <span class="na">culture=</span><span class="s">&quot;neutral&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;publisherPolicy</span> <span class="na">apply=</span><span class="s">&quot;no&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/dependentAssembly&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/assemblyBinding&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/runtime&gt;</span>
</span><span class='line'><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s all there is to it. Now Fusion binding should find the correct assembly instead of trying to load the CRM 2011 out of the GAC.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/10/12/updating-expired-license-key-in-crm-2011/">Updating Expired License Key in CRM 2011</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-10-12T13:04:07-07:00" pubdate data-updated="true">Oct 12<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Like me, I&#8217;m sure that many of you are consultants who have clients running on a trial version of the CRM software. Also, like me, you probably have a lot of CRM installations for testing.</p>

<p>Here is how you can update the product key in Microsoft CRM 2011. Get the new key from the client if it is a retail key that they purchased or grab a key from your MSDN subscription if it is one of your testing instances. Once you have the key, just open up the CRM Deployment Manager and look for the option hightlighted below:</p>

<p><a href="http://crmvoyager.files.wordpress.com/2011/10/crm-productkey.png"><img src="http://crmvoyager.files.wordpress.com/2011/10/crm-productkey.png" alt="" /></a></p>

<p>Enter the key in the pop up window and enjoy life again!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/05/using-activityparty-in-crm-2011/">Using ActivityParty in CRM 2011</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-05T11:53:09-07:00" pubdate data-updated="true">Jun 5<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was writing some client code recently when I wanted to add a customer reference to a CRM campaignresponse entity instance. Using a simple EntityReference was giving me errors, so I looked to see what the data type was in CRM. Looking in the customisations screen, the type was &#8216;Party List&#8217;. The CRM SDK docs say that we should be able to use ActivityParty[] or EntityCollection for the field value.</p>

<p>The only info on ActivityParty that I found was <a href="http://crmentropy.blogspot.com/2009/04/using-activityparty-in-partylist-for.html">for CRM4</a>. Through trial and error I arrived at the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">Entity</span> <span class="n">customer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">(</span><span class="s">&quot;activityparty&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">customer</span><span class="p">[</span><span class="s">&quot;partyid&quot;</span> <span class="p">]=</span> <span class="k">new</span> <span class="n">EntityReference</span><span class="p">(</span> <span class="s">&quot;contact&quot;</span><span class="p">,</span> <span class="n">in_contactID</span> <span class="p">);</span>
</span><span class='line'><span class="n">campaignResponse</span><span class="p">[</span><span class="s">&quot;customer&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EntityCollection</span><span class="p">(</span> <span class="k">new</span> <span class="n">List</span><span class="p">(){</span> <span class="n">customer</span> <span class="p">}</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>So what I had to do was create a list of entities that had an EntityReference field set that pointed to the contact. You cannot set the EntityReference directly on the campaignresponse, it is expecting an EntityCollection. Hopefully this saves you some time.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/17/managing-crm-2011-from-powershell/">Managing CRM 2011 From PowerShell</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-17T00:24:55-07:00" pubdate data-updated="true">May 17<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Starting with Windows Server 2008, Microsoft has stepped up its commitment to scriptable server management with the inclusion of PowerShell by default in the operating system. PowerShell enables the ease of scripting like batch files with the power of a scripting language like perl. Anyone that has done any extensive batch scripting will know what a pain it can be to do simple things like string handling.</p>

<p>Microsoft has doubled down on PowerShell in both CRM and SharePoint. Both are able to be managed using PowerShell snapins. What is a snapin? Snapins are what Microsoft calls script modules that can be loaded into PowerShell. The management features of CRM 2011 are supplied via a snapin.</p>

<p>The snapin will be installed on the CRM server by default, so to start powershell and load the snapin, we open up a console window and do the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\&gt; powershell
</span><span class='line'>Windows PowerShell
</span><span class='line'>Copyright (C) 2009 Microsoft Corporation. All rights reserved.
</span><span class='line'>
</span><span class='line'>PS C:\Users\Administrator&gt; add-pssnapin Microsoft.CRM.Powershell
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Now we have access to all of the cmdlets (this is PowerShell terminology for a command tool).</p>

<p>For example, we can get information on the default CRM organization:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>PS C:\Users\Administrator&gt; get-crmorganization
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>BaseCurrencyCode      : USD
</span><span class='line'>BaseCurrencyName      : US Dollar
</span><span class='line'>BaseCurrencyPrecision : 2
</span><span class='line'>BaseCurrencySymbol    : $
</span><span class='line'>BaseLanguageCode      : 1033
</span><span class='line'>DatabaseName          : crmtest_MSCRM
</span><span class='line'>FriendlyName          : CRM Test
</span><span class='line'>Id                    : 04721a7a-e0f5-45dc-a4b7-57e02088a13a
</span><span class='line'>SqlCollation          : Latin1_General_CI_AI
</span><span class='line'>SqlServerName         : WIN-0VODKV30814\SQL2008R2STD
</span><span class='line'>SqmIsEnabled          : False
</span><span class='line'>SrsUrl                : http://win-0vodkv30814/reportserver_sql2008r2std
</span><span class='line'>State                 : Enabled
</span><span class='line'>UniqueName            : crmtest
</span><span class='line'>Version               : 5.0.9688.34
</span><span class='line'>ExtensionData         : System.Runtime.Serialization.ExtensionDataObject
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Here is a list of all of the <a href="http://msdn.microsoft.com/en-us/library/gg328563.aspx">available commands</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/04/crm-2011-entity-metadata-browser/">Crm 2011 Entity Metadata Browser</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-04T19:49:34-07:00" pubdate data-updated="true">May 4<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Any of you out there that have been working with Microsoft CRM for a while will remember that since CRM3.0 there has been a handy metadata browser built into the CRM server for quickly looking up things like field names and entity relationships. In CRM3.0 you just browsed to http://yourcrmserver/sdk/list.aspx and in 4.0 it was the same only we had to specify the organization name like http://yourcrmserver/orgname/sdk/list.aspx since 4.0 was a fully multi-tenant CRM solution.</p>

<p>I was really disappointed to see that the metadata browser was omitted from CRM 2011. However, Microsoft came through recently by including an <a href="http://blogs.msdn.com/b/crm/archive/2011/03/09/metadata-browser-for-microsoft-dynamics-crm-2011.aspx">all-new version of the metadata browser</a> in the latest CRM 2011 SDK.</p>

<p>The new browser is distributed as a managed CRM solution and can be installed and uninstalled just like any other CRM 2011 customization package. This is a really cool demonstration of what is possible with CRM solutions.</p>

<p>To install, grab the latest SDK from <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=420f0f05-c226-4194-b7e1-f23ceaa83b69">here</a> and extract. Open up your CRM installation and browse to the customizations as shown in the following screenshot:</p>

<p><a href="http://crmvoyager.files.wordpress.com/2011/05/import-solution.png"><img src="http://crmvoyager.files.wordpress.com/2011/05/import-solution.png" alt="" /></a></p>

<p>The file that we want to import is located in the sdk under:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>sdk\tools\metadatabrowser\metadatabrowser_1_0_0_1_managed.zip
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://crmvoyager.files.wordpress.com/2011/05/select-file.png"><img src="http://crmvoyager.files.wordpress.com/2011/05/select-file.png" alt="" /></a></p>

<p>Once the import is complete you can navigate to the browser by going to settings/customizations/metadata browser as shown below:</p>

<p><a href="http://crmvoyager.files.wordpress.com/2011/05/browser.png"><img src="http://crmvoyager.files.wordpress.com/2011/05/browser.png" alt="" /></a></p>

<p>Enjoy not having to poke around in the customizations menu and drill into the individual entities just to figure out what you named that field.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/26/starting-sql-server-2008-in-single-user-mode/">Starting SQL Server 2008 in Single-user Mode</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-26T00:01:45-07:00" pubdate data-updated="true">Apr 26<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had to go through the rain dance of <a href="http://msdn.microsoft.com/en-us/library/dd207004.aspx">adding the Administrator account back</a> to SQL Server after there were no admin accounts that could log in. This can happen if the SQL server box has been removed from a domain and SQL Server was installed using domain accounts. If mixed mode authentication is disabled and you can&#8217;t log in as the sa account, you&#8217;ll have to start SQL up in single-user mode in order to connect to it.</p>

<p>Ordinarily you would give the -m flag to the sqlserver.exe executable and be on your merry way. However, this time around I ran into a perplexing issue. Take a look at the following screenshot to see the welcome that I received after running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>C:<span class="se">\P</span>rogram Files<span class="se">\M</span>icrosoft SQL Server<span class="se">\M</span>SSQL10_50.SQL2008R2STD<span class="se">\M</span>SSQL<span class="se">\B</span>inn&gt;sqlservr.exe -m
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://crmvoyager.files.wordpress.com/2011/04/sqlsserver.png"><img src="http://crmvoyager.files.wordpress.com/2011/04/sqlsserver.png" alt="" /></a></p>

<p>Quite informative. I took a look in the services administrative tool to see what the service commandline was and discovered that there is an <a href="http://msdn.microsoft.com/en-us/library/ms190737.aspx">-s flag</a> that starts a named instance. I also have SQL Server Express running on this same machine, so there was a conflict.</p>

<p>I used the following command to get it started:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>C:<span class="se">\P</span>rogram Files<span class="se">\M</span>icrosoft SQL Server<span class="se">\M</span>SSQL10_50.SQL2008R2STD<span class="se">\M</span>SSQL<span class="se">\B</span>inn&gt;sqlservr.exe  -sSQL2008R2STD -m
</span></code></pre></td></tr></table></div></figure>


<p>And you should be greeted by this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>2011-04-26 00:50:37.40 Server      Microsoft SQL Server 2008 R2 <span class="o">(</span>RTM<span class="o">)</span> - 10.50.16
</span><span class='line'>00.1 <span class="o">(</span>X64<span class="o">)</span>
</span><span class='line'>        Apr  2 2010 15:48:46
</span><span class='line'>        Copyright <span class="o">(</span>c<span class="o">)</span> Microsoft Corporation
</span><span class='line'>        Standard Edition <span class="o">(</span>64-bit<span class="o">)</span> on Windows NT 6.1 &lt;X64&gt; <span class="o">(</span>Build 7600: <span class="o">)</span>
</span><span class='line'>
</span><span class='line'>2011-04-26 00:50:37.41 Server      <span class="o">(</span>c<span class="o">)</span> Microsoft Corporation.
</span><span class='line'>2011-04-26 00:50:37.41 Server      All rights reserved.
</span><span class='line'>2011-04-26 00:50:37.41 Server      Server process ID is 4064.
</span><span class='line'>2011-04-26 00:50:37.41 Server      System Manufacturer: <span class="s1">&#39;innotek GmbH&#39;</span>, System M
</span><span class='line'>odel: <span class="s1">&#39;VirtualBox&#39;</span>.
</span><span class='line'>2011-04-26 00:50:37.41 Server      Authentication mode is WINDOWS-ONLY.
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/22/storing-a-guid-in-an-asp-net-checkbox-control/">Storing a Guid in an ASP.NET CheckBox Control</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-22T16:13:33-07:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently had to build a simple UI for listing out a set of Microsoft CRM entities to choose from. The natural way of presenting this to the user was to give them a list of items with some associated checkboxes for selection. I wanted to associate a CRM entity ID with each checkbox so that I could update the entity in CRM when the user submitted the form.</p>

<p>There are a number of different ways that this problem can be approached. One thing that I&#8217;ve done in the past is to use hidden form fields to store the data for postback. Another would be to use the entity Guid as the control ID. Yet another way would be to store a dictionary in ASP.NET session state, keyed by the control ID.</p>

<p>However, I wanted to create a more elegant solution to this problem by attaching a Guid field directly to the CheckBox control so that we&#8217;d have easy access to it during page postback.</p>

<p>My first thought was to create an ASP.NET server control that extends Microsoft&#8217;s own CheckBox control. This is easy to do, as I show in the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ExtendedCheckbox</span> <span class="p">:</span> <span class="n">CheckBox</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="n">Guid</span> <span class="n">ItemID</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">public</span> <span class="nf">ExtendedCheckbox</span><span class="p">()</span> <span class="p">{}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>All we did was add a single property to the basic CheckBox control. This code will let us use the ExtendedCheckbox control on our pages and allow us to set a property called ItemID. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;djn:ExtendedCheckbox</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">ItemID=</span><span class="s">&quot;&lt;%=myID%&gt;&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>However in order to be useful to us, the value of ItemID must persist when the page is posted back. When the user hits the &#8216;submit&#8217; button on our page, we presumably want to do something useful with this ID like make a CRM request to modify the entity with the checkbox information. All of the built-in properties of the CheckBox use the ASP.NET ViewState mechanism to accomplish this. Unfortunately our custom property doesn&#8217;t benefit from the base class&#8217;s ViewState implicitly, so we have to make a change to our property as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="n">Guid</span> <span class="n">ItemID</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">get</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span> <span class="n">ViewState</span><span class="p">[</span><span class="s">&quot;ItemID&quot;</span><span class="p">]</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">)</span>
</span><span class='line'>          <span class="k">return</span> <span class="p">(</span> <span class="n">Guid</span> <span class="p">)</span><span class="n">ViewState</span><span class="p">[</span><span class="s">&quot;ItemID&quot;</span><span class="p">];</span>
</span><span class='line'>      <span class="k">return</span> <span class="nf">default</span><span class="p">(</span> <span class="n">Guid</span> <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">set</span> <span class="p">{</span> <span class="n">ViewState</span><span class="p">[</span><span class="s">&quot;ItemID&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So you can see that we used the base class&#8217;s own ViewState collection to store our own data for the custom property. Now when we do a postback, the value of ItemID will be available to us.</p>

<p>To use this new control, we have to register it in the page where we are going to use it. In my case, the code for the new control is in the App_Code folder, so my @register directive looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="err">&lt;</span>%@ Register TagPrefix=&quot;djn&quot; namespace=&quot;Djn.Controls&quot; Assembly=&quot;__code&quot; %&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Note that we can reference the assembly generated from App_Code by using __code as the assembly reference.</p>

<p>We can now use the control just like a built in control, albeit with a new custom field. Accessing the ItemID later on in code is as simple as referencing the checkbox by name:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">Guid</span> <span class="n">id</span> <span class="p">=</span> <span class="n">myCustomCheckbox</span><span class="p">.</span><span class="n">ItemID</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hopefully this gives you some ideas when doing custom ASP.NET work for your clients.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/20/creating-custom-error-pages-in-asp-net/">Creating Custom Error Pages in ASP.NET</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-20T14:23:02-07:00" pubdate data-updated="true">Apr 20<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>How many times have you been in a client demo when your application throws an ugly stack trace up on the screen? Double points if it is up on the projector at about eight feet wide.</p>

<p>Now, I don&#8217;t like to go overboard with excessive exception handling just to avoid the appearance of errors, but there is one thing that we can do easily that will still allow us to avoid swallowing exceptions all over and it is as easy as putting a few lines into your web.config.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;system.web&gt;</span>
</span><span class='line'>    <span class="nt">&lt;customErrors</span> <span class="na">mode=</span><span class="s">&quot;On&quot;</span> <span class="na">defaultRedirect=</span><span class="s">&quot;Error.aspx&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    ...
</span><span class='line'><span class="nt">&lt;/system.web&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will redirect the browser to Error.aspx on any unhandled exception in the application. We can still do some error logging by looking at the results of:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">Server</span><span class="p">.</span><span class="n">GetLastError</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://www.codeproject.com/KB/aspnet/Error_Page_for_aspnst.aspx">Here</a> are some more details about getting error details in the custom error page.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/20/programmatically-executing-workflows-in-crm-2011/">Programmatically Executing Workflows in CRM 2011</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-20T08:52:47-07:00" pubdate data-updated="true">Apr 20<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I came across some code recently that gave me pause, so I thought I&#8217;d explore it a little bit here.</p>

<p>We&#8217;ve recently converted a lot of code from CRM 4.0 to CRM 2011, and one of those pieces of code involved kicking off a Windows workflow. The following code snippet is right out of the CRM 2011 SDK:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="p">(</span><span class="n">_serviceProxy</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OrganizationServiceProxy</span><span class="p">(</span><span class="n">serverConfig</span><span class="p">.</span><span class="n">OrganizationUri</span><span class="p">,</span>
</span><span class='line'>    <span class="n">serverConfig</span><span class="p">.</span><span class="n">HomeRealmUri</span><span class="p">,</span>
</span><span class='line'>    <span class="n">serverConfig</span><span class="p">.</span><span class="n">Credentials</span><span class="p">,</span>
</span><span class='line'>    <span class="n">serverConfig</span><span class="p">.</span><span class="n">DeviceCredentials</span><span class="p">))</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>     <span class="c1">// Create an ExecuteWorkflow request.</span>
</span><span class='line'>     <span class="n">ExecuteWorkflowRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ExecuteWorkflowRequest</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">WorkflowId</span> <span class="p">=</span> <span class="n">_workflowId</span><span class="p">,</span>
</span><span class='line'>         <span class="n">EntityId</span> <span class="p">=</span> <span class="n">_leadId</span>
</span><span class='line'>     <span class="p">};</span>
</span><span class='line'>     <span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;Created ExecuteWorkflow request, &quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>     <span class="c1">// Execute the workflow.</span>
</span><span class='line'>     <span class="n">ExecuteWorkflowResponse</span> <span class="n">response</span> <span class="p">=</span>
</span><span class='line'>        <span class="p">(</span><span class="n">ExecuteWorkflowResponse</span><span class="p">)</span><span class="n">_serviceProxy</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I have paraphrased this code to illustrate my example more clearly. This is an example of a very typical workflow execution scenario. The thing that gave me pause was that I couldn&#8217;t resolve the type ExecuteWorkflowRequest or ExecuteWorkflowResponse.</p>

<p>Looking more closely at the SDK example, I noticed the following at the top of the file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="c1">// This namespace is found in Microsoft.Crm.Sdk.Proxy.dll assembly</span>
</span><span class='line'><span class="c1">// found in the SDK\bin folder.</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Microsoft.Crm.Sdk.Messages</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So even though most of the other types are in the Microsoft.Xrm namespace, for some reason these types were left behind in Microsoft.Crm.</p>

<p>Hopefully this saves you some time.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/13/handling-errors-with-the-crm-2011-web-services-api/">Handling Errors With the CRM 2011 Web Services API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-04-13T11:59:42-07:00" pubdate data-updated="true">Apr 13<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Early on in my experiences with CRM programming I learned to do whatever I can to get meaningful error responses from the server. Nothing is more difficult than having a Web service call fail and not being able to tell what happened by looking at the stack trace.</p>

<p>Since the CRM API is delivered using .NET Web services, we are crossing some process and protocol boundaries. In particular, CRM adheres to the SOAP standard of returning errors as <a href="http://www.w3.org/TR/2000/NOTE-SOAP-20000508/#_Toc478383507">SOAP faults</a>.</p>

<p>In order to implement this feature with .NET exceptions, Microsoft has created a custom exception type - the SoapException. The meaningful data of the SOAP fault is contained in a field called SoapException.Detail.InnerXml. The issue here is that most of the time when the calling code is handling exceptions, we don&#8217;t see this field since we are dealing with System.Exception types most of the time.</p>

<p>What I have been doing from the beginning is to rethrow the System.Web.Services.Protocols.SoapException as a System.Exception and include the Xml as the exception message. Consider the following error handler:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">try</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nf">DoCrmCall</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">catch</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">Protocols</span><span class="p">.</span><span class="n">SoapException</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Detail</span><span class="p">.</span><span class="n">InnerXml</span><span class="p">,</span> <span class="n">ex</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When we see the exception in the calling code (the .NET service proxy) we get a System.Exception where the message contains the Xml from the SOAP fault. There may be better ways of handling the SOAP messages, but this method has been working well for me, and I thought I&#8217;d put it up for you guys to comment on, since I know that error messages are a hot button topic in CRM and Web services in general.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/11/21/debugging-microsoft-crm-generic-sql-error/">Debugging Microsoft CRM &#8220;Generic SQL Error&#8221;</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/17/loading-configuration-from-an-alternative-location-in-microsoft-net/">Loading configuration from an alternative location in Microsoft .NET</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/17/configuration-types-in-microsoft-net/">Configuration types in Microsoft .NET</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/17/programmatically-creating-crm-4-entity-metadata/">Programmatically creating CRM 4 entity metadata</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/16/configuration-patterns-in-net/">Configuration patterns in .NET</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Dan Newcome -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'crmvoyager';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
